{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attackcapital/SignalHub/frontend/src/components/modals/ConfirmModal.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useRef } from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\n\r\ntype ConfirmModalProps = {\r\n  open: boolean;\r\n  title?: string;\r\n  message?: string;\r\n  confirmLabel?: string;\r\n  cancelLabel?: string;\r\n  onConfirm: () => Promise<void> | void;\r\n  onCancel: () => void;\r\n};\r\n\r\nexport default function ConfirmModal({\r\n  open,\r\n  title = \"Confirm\",\r\n  message = \"Are you sure?\",\r\n  confirmLabel = \"Yes\",\r\n  cancelLabel = \"Cancel\",\r\n  onConfirm,\r\n  onCancel,\r\n}: ConfirmModalProps) {\r\n  const ref = useRef<HTMLDivElement | null>(null);\r\n  const primaryBtnRef = useRef<HTMLButtonElement | null>(null);\r\n\r\n  // prevent background scroll\r\n  useEffect(() => {\r\n    if (!open) return;\r\n    const prev = document.body.style.overflow;\r\n    document.body.style.overflow = \"hidden\";\r\n    primaryBtnRef.current?.focus();\r\n    return () => {\r\n      document.body.style.overflow = prev;\r\n    };\r\n  }, [open]);\r\n\r\n  // close on ESC\r\n  useEffect(() => {\r\n    function onKey(e: KeyboardEvent) {\r\n      if (e.key === \"Escape\") onCancel();\r\n    }\r\n    if (open) window.addEventListener(\"keydown\", onKey);\r\n    return () => window.removeEventListener(\"keydown\", onKey);\r\n  }, [open, onCancel]);\r\n\r\n  if (!open) return null;\r\n\r\n  return ReactDOM.createPortal(\r\n    <div\r\n      role=\"dialog\"\r\n      aria-modal=\"true\"\r\n      aria-labelledby=\"confirm-title\"\r\n      className=\"fixed inset-0 z-50 flex items-center justify-center p-4\"\r\n    >\r\n      <div\r\n        className=\"absolute inset-0 bg-black/40 backdrop-blur-sm\"\r\n        onClick={onCancel}\r\n        aria-hidden\r\n      />\r\n      <div\r\n        ref={ref}\r\n        className=\"relative z-10 max-w-lg w-full bg-white rounded-2xl shadow-xl border p-6\"\r\n      >\r\n        <h3 id=\"confirm-title\" className=\"text-lg font-semibold text-slate-900\">\r\n          {title}\r\n        </h3>\r\n        <p className=\"mt-2 text-sm text-slate-600\">{message}</p>\r\n\r\n        <div className=\"mt-6 flex justify-end gap-3\">\r\n          <button\r\n            onClick={onCancel}\r\n            className=\"px-4 py-2 rounded-lg border text-sm text-slate-700 hover:bg-slate-50\"\r\n          >\r\n            {cancelLabel}\r\n          </button>\r\n          <button\r\n            ref={primaryBtnRef}\r\n            onClick={() => void onConfirm()}\r\n            className=\"px-4 py-2 rounded-lg bg-red-600 text-white text-sm hover:opacity-95\"\r\n          >\r\n            {confirmLabel}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>,\r\n    document.body\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAee,SAAS,aAAa,EACnC,IAAI,EACJ,QAAQ,SAAS,EACjB,UAAU,eAAe,EACzB,eAAe,KAAK,EACpB,cAAc,QAAQ,EACtB,SAAS,EACT,QAAQ,EACU;IAClB,MAAM,MAAM,IAAA,2NAAM,EAAwB;IAC1C,MAAM,gBAAgB,IAAA,2NAAM,EAA2B;IAEvD,4BAA4B;IAC5B,IAAA,8NAAS,EAAC;QACR,IAAI,CAAC,MAAM;QACX,MAAM,OAAO,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ;QACzC,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;QAC/B,cAAc,OAAO,EAAE;QACvB,OAAO;YACL,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;QACjC;IACF,GAAG;QAAC;KAAK;IAET,eAAe;IACf,IAAA,8NAAS,EAAC;QACR,SAAS,MAAM,CAAgB;YAC7B,IAAI,EAAE,GAAG,KAAK,UAAU;QAC1B;QACA,IAAI,MAAM,OAAO,gBAAgB,CAAC,WAAW;QAC7C,OAAO,IAAM,OAAO,mBAAmB,CAAC,WAAW;IACrD,GAAG;QAAC;QAAM;KAAS;IAEnB,IAAI,CAAC,MAAM,OAAO;IAElB,qBAAO,mOAAQ,CAAC,YAAY,eAC1B,0PAAC;QACC,MAAK;QACL,cAAW;QACX,mBAAgB;QAChB,WAAU;;0BAEV,0PAAC;gBACC,WAAU;gBACV,SAAS;gBACT,aAAW;;;;;;0BAEb,0PAAC;gBACC,KAAK;gBACL,WAAU;;kCAEV,0PAAC;wBAAG,IAAG;wBAAgB,WAAU;kCAC9B;;;;;;kCAEH,0PAAC;wBAAE,WAAU;kCAA+B;;;;;;kCAE5C,0PAAC;wBAAI,WAAU;;0CACb,0PAAC;gCACC,SAAS;gCACT,WAAU;0CAET;;;;;;0CAEH,0PAAC;gCACC,KAAK;gCACL,SAAS,IAAM,KAAK;gCACpB,WAAU;0CAET;;;;;;;;;;;;;;;;;;;;;;;cAKT,SAAS,IAAI;AAEjB","debugId":null}},
    {"offset": {"line": 147, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attackcapital/SignalHub/frontend/src/components/profile/ProfileMenu.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport ConfirmModal from \"../modals/ConfirmModal\";\r\n\r\nexport default function ProfileMenu({ avatarUrl, email }: { avatarUrl?: string; email?: string }) {\r\n  const router = useRouter();\r\n  const [open, setOpen] = useState(false);\r\n  const [confirmOpen, setConfirmOpen] = useState(false);\r\n  const [loggingOut, setLoggingOut] = useState(false);\r\n  const menuRef = useRef<HTMLDivElement | null>(null);\r\n\r\n  // close on outside click\r\n  useEffect(() => {\r\n    function onDocClick(e: MouseEvent) {\r\n      if (!menuRef.current) return;\r\n      if (!(e.target instanceof Node)) return;\r\n      if (!menuRef.current.contains(e.target)) setOpen(false);\r\n    }\r\n    document.addEventListener(\"mousedown\", onDocClick);\r\n    return () => document.removeEventListener(\"mousedown\", onDocClick);\r\n  }, []);\r\n\r\n  // keyboard support\r\n  useEffect(() => {\r\n    function onKey(e: KeyboardEvent) {\r\n      if (e.key === \"Escape\") setOpen(false);\r\n    }\r\n    if (open) window.addEventListener(\"keydown\", onKey);\r\n    return () => window.removeEventListener(\"keydown\", onKey);\r\n  }, [open]);\r\n\r\n  async function handleLogout() {\r\n    try {\r\n      setLoggingOut(true);\r\n      const res = await fetch(\"/api/auth/logout\", { method: \"POST\" });\r\n      // ignore body; route clears cookie\r\n      setConfirmOpen(false);\r\n      setOpen(false);\r\n      // redirect to login page\r\n      router.replace(\"/auth/login\");\r\n    } catch (err) {\r\n      console.error(\"Logout failed\", err);\r\n      setLoggingOut(false);\r\n      setConfirmOpen(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"relative\" ref={menuRef}>\r\n      <button\r\n        aria-haspopup=\"menu\"\r\n        aria-expanded={open}\r\n        onClick={() => setOpen((v) => !v)}\r\n        className=\"w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center shadow-sm hover:opacity-95\"\r\n        title=\"Account menu\"\r\n      >\r\n        {avatarUrl ? (\r\n          <img src={avatarUrl} alt=\"avatar\" className=\"w-10 h-10 rounded-full object-cover\" />\r\n        ) : (\r\n          <span className=\"text-sm font-medium text-slate-700\">{(email || \"U\").charAt(0).toUpperCase()}</span>\r\n        )}\r\n      </button>\r\n\r\n      {open && (\r\n        <div\r\n          role=\"menu\"\r\n          aria-label=\"Profile\"\r\n          className=\"absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg border py-2 z-20\"\r\n        >\r\n          <button\r\n            role=\"menuitem\"\r\n            onClick={() => {\r\n              setOpen(false);\r\n              router.push(\"/profile\");\r\n            }}\r\n            className=\"w-full text-left px-3 py-2 hover:bg-slate-50 text-sm text-slate-700\"\r\n          >\r\n            View profile\r\n          </button>\r\n\r\n          <button\r\n            role=\"menuitem\"\r\n            onClick={() => {\r\n              setConfirmOpen(true);\r\n            }}\r\n            className=\"w-full text-left px-3 py-2 hover:bg-slate-50 text-sm text-slate-700\"\r\n          >\r\n            Logout\r\n          </button>\r\n        </div>\r\n      )}\r\n\r\n      <ConfirmModal\r\n        open={confirmOpen}\r\n        title=\"Log out?\"\r\n        message=\"Do you want to logout?\"\r\n        confirmLabel={loggingOut ? \"Logging out...\" : \"Yes, log out\"}\r\n        cancelLabel=\"Cancel\"\r\n        onCancel={() => setConfirmOpen(false)}\r\n        onConfirm={async () => {\r\n          await handleLogout();\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAMe,SAAS,YAAY,EAAE,SAAS,EAAE,KAAK,EAA0C;IAC9F,MAAM,SAAS,IAAA,2JAAS;IACxB,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,6NAAQ,EAAC;IACjC,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,6NAAQ,EAAC;IAC/C,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,6NAAQ,EAAC;IAC7C,MAAM,UAAU,IAAA,2NAAM,EAAwB;IAE9C,yBAAyB;IACzB,IAAA,8NAAS,EAAC;QACR,SAAS,WAAW,CAAa;YAC/B,IAAI,CAAC,QAAQ,OAAO,EAAE;YACtB,IAAI,CAAC,CAAC,EAAE,MAAM,YAAY,IAAI,GAAG;YACjC,IAAI,CAAC,QAAQ,OAAO,CAAC,QAAQ,CAAC,EAAE,MAAM,GAAG,QAAQ;QACnD;QACA,SAAS,gBAAgB,CAAC,aAAa;QACvC,OAAO,IAAM,SAAS,mBAAmB,CAAC,aAAa;IACzD,GAAG,EAAE;IAEL,mBAAmB;IACnB,IAAA,8NAAS,EAAC;QACR,SAAS,MAAM,CAAgB;YAC7B,IAAI,EAAE,GAAG,KAAK,UAAU,QAAQ;QAClC;QACA,IAAI,MAAM,OAAO,gBAAgB,CAAC,WAAW;QAC7C,OAAO,IAAM,OAAO,mBAAmB,CAAC,WAAW;IACrD,GAAG;QAAC;KAAK;IAET,eAAe;QACb,IAAI;YACF,cAAc;YACd,MAAM,MAAM,MAAM,MAAM,oBAAoB;gBAAE,QAAQ;YAAO;YAC7D,mCAAmC;YACnC,eAAe;YACf,QAAQ;YACR,yBAAyB;YACzB,OAAO,OAAO,CAAC;QACjB,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,iBAAiB;YAC/B,cAAc;YACd,eAAe;QACjB;IACF;IAEA,qBACE,0PAAC;QAAI,WAAU;QAAW,KAAK;;0BAC7B,0PAAC;gBACC,iBAAc;gBACd,iBAAe;gBACf,SAAS,IAAM,QAAQ,CAAC,IAAM,CAAC;gBAC/B,WAAU;gBACV,OAAM;0BAEL,0BACC,0PAAC;oBAAI,KAAK;oBAAW,KAAI;oBAAS,WAAU;;;;;yCAE5C,0PAAC;oBAAK,WAAU;8BAAsC,CAAC,SAAS,GAAG,EAAE,MAAM,CAAC,GAAG,WAAW;;;;;;;;;;;YAI7F,sBACC,0PAAC;gBACC,MAAK;gBACL,cAAW;gBACX,WAAU;;kCAEV,0PAAC;wBACC,MAAK;wBACL,SAAS;4BACP,QAAQ;4BACR,OAAO,IAAI,CAAC;wBACd;wBACA,WAAU;kCACX;;;;;;kCAID,0PAAC;wBACC,MAAK;wBACL,SAAS;4BACP,eAAe;wBACjB;wBACA,WAAU;kCACX;;;;;;;;;;;;0BAML,0PAAC,mKAAY;gBACX,MAAM;gBACN,OAAM;gBACN,SAAQ;gBACR,cAAc,aAAa,mBAAmB;gBAC9C,aAAY;gBACZ,UAAU,IAAM,eAAe;gBAC/B,WAAW;oBACT,MAAM;gBACR;;;;;;;;;;;;AAIR","debugId":null}},
    {"offset": {"line": 302, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attackcapital/SignalHub/frontend/src/app/welcome/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useMemo, useRef, useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport ProfileMenu from \"@/components/profile/ProfileMenu\";\r\nimport * as Y from \"yjs\";\r\nimport { WebsocketProvider } from \"y-websocket\";\r\n\r\n/**\r\n * WelcomePage (rewritten)\r\n *\r\n * Changes:\r\n * - Composer's \"To\" is now a selection based on verified contacts/emails.\r\n * - Contacts loaded from /api/contacts (fallback /api/users).\r\n * - Filtering by channel: SMS/WHATSAPP -> phones only, EMAIL -> emails only.\r\n *\r\n * Server endpoints expected (unchanged except contact list):\r\n * - POST /api/messages/send\r\n * - POST /api/messages/schedule\r\n * - GET  /api/contacts/:id\r\n * - GET  /api/contacts/:id/notes\r\n * - POST /api/contacts/:id/notes\r\n * - GET  /api/threads?limit=...\r\n * - GET  /api/twilio/numbers\r\n * - POST /api/twilio/buy\r\n * - WS   /api/ws\r\n * - Yjs WS at NEXT_PUBLIC_YJS_WS\r\n */\r\n\r\ntype Role = \"VIEWER\" | \"EDITOR\" | \"ADMIN\" | string;\r\n\r\ntype User = {\r\n  id: string;\r\n  email: string;\r\n  name?: string;\r\n  role?: Role;\r\n  tenantId?: string | null;\r\n};\r\n\r\ntype AnalyticsSummary = {\r\n  messages7d: number;\r\n  avgResponseMins: number;\r\n  openRatePct: number;\r\n  sparkline: number[];\r\n};\r\n\r\ntype ThreadPreviewItem = {\r\n  id: string;\r\n  contactId?: string;\r\n  contactName: string;\r\n  contactPhone?: string;\r\n  channels: string[];\r\n  snippet: string;\r\n  lastAt: string; // ISO\r\n  unreadCount?: number;\r\n  status?: string;\r\n  scheduled?: boolean;\r\n};\r\n\r\ntype ProviderNumber = {\r\n  id: string;\r\n  phone: string;\r\n  provider: string;\r\n  capabilities?: Record<string, boolean>;\r\n  purchased: boolean;\r\n};\r\n\r\ntype ContactItem = {\r\n  id: string;\r\n  name?: string | null;\r\n  email?: string | null;\r\n  emailVerified?: boolean;\r\n  phone?: string | null; // E.164\r\n  phoneVerified?: boolean;\r\n};\r\n\r\n/* ----------------------------- Page ---------------------------- */\r\n\r\nexport default function WelcomePage() {\r\n  const router = useRouter();\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const [analytics, setAnalytics] = useState<AnalyticsSummary | null>(null);\r\n  const [threads, setThreads] = useState<ThreadPreviewItem[]>([]);\r\n  const [numbers, setNumbers] = useState<ProviderNumber[]>([]);\r\n\r\n  // NEW: contacts list used for composer \"To\" selection\r\n  const [contacts, setContacts] = useState<ContactItem[]>([]);\r\n\r\n  const [composerOpen, setComposerOpen] = useState(false);\r\n  const [composerContext, setComposerContext] = useState<{ threadId?: string; contactId?: string } | null>(null);\r\n  const [contactModal, setContactModal] = useState<{ contactId: string } | null>(null);\r\n  const [buying, setBuying] = useState<string | null>(null);\r\n\r\n  const [presence, setPresence] = useState<Record<string, { name?: string; idle?: boolean }>>({});\r\n\r\n  const wsRef = useRef<WebSocket | null>(null);\r\n\r\n  // Derived role helpers\r\n  const role = (user?.role ?? \"VIEWER\").toString().toUpperCase();\r\n  const isAdmin = role === \"ADMIN\";\r\n  const isEditor = role === \"EDITOR\" || isAdmin;\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    const controller = new AbortController();\r\n    const signal = controller.signal;\r\n\r\n    async function loadAll() {\r\n      setLoading(true);\r\n      try {\r\n        const [meRes, analyticsRes, threadsRes, numbersRes] = await Promise.all([\r\n          fetch(`/api/me`, { signal }),\r\n          fetch(`/api/analytics/summary`, { signal }),\r\n          fetch(`/api/threads?limit=10`, { signal }),\r\n          fetch(`/api/twilio/numbers`, { signal }),\r\n        ]);\r\n\r\n        if (!mounted) return;\r\n\r\n        // /api/me\r\n        if (meRes.ok) {\r\n          try {\r\n            const j = await meRes.json();\r\n            setUser(j.user ?? null);\r\n          } catch (err) {\r\n            console.warn(\"welcome: /api/me parse error\", err);\r\n            setUser(null);\r\n          }\r\n        } else {\r\n          setUser(null);\r\n        }\r\n\r\n        // analytics\r\n        if (analyticsRes.ok) {\r\n          try {\r\n            const j = await analyticsRes.json();\r\n            setAnalytics({\r\n              messages7d: j.messages7d ?? 0,\r\n              avgResponseMins: j.avgResponseMins ?? 0,\r\n              openRatePct: j.openRatePct ?? 0,\r\n              sparkline: Array.isArray(j.sparkline) && j.sparkline.length ? j.sparkline : [1, 2, 3, 2, 4],\r\n            });\r\n          } catch (e) {\r\n            console.warn(\"welcome: analytics parse error\", e);\r\n            setAnalytics(null);\r\n          }\r\n        }\r\n\r\n        // threads\r\n        if (threadsRes.ok) {\r\n          try {\r\n            const j = await threadsRes.json();\r\n            setThreads(Array.isArray(j.threads) ? j.threads : []);\r\n          } catch (e) {\r\n            console.warn(\"welcome: threads parse error\", e);\r\n            setThreads([]);\r\n          }\r\n        }\r\n\r\n        // numbers\r\n        if (numbersRes.ok) {\r\n          try {\r\n            const j = await numbersRes.json();\r\n            setNumbers(Array.isArray(j.numbers) ? j.numbers : []);\r\n          } catch (e) {\r\n            console.warn(\"welcome: numbers parse error\", e);\r\n            setNumbers([]);\r\n          }\r\n        }\r\n\r\n        // load contacts list for composer (best-effort)\r\n        try {\r\n          await fetchContacts(signal);\r\n        } catch (err) {\r\n          console.warn(\"welcome: fetchContacts failed\", err);\r\n        }\r\n      } catch (e) {\r\n        if ((e as any).name === \"AbortError\") {\r\n          // expected on unmount\r\n        } else {\r\n          console.error(\"welcome: loadAll error\", e);\r\n        }\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    }\r\n\r\n    loadAll();\r\n\r\n    return () => {\r\n      mounted = false;\r\n      controller.abort();\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  // Fetch contacts list (prefers /api/contacts, fallback to /api/users)\r\n // Replace existing fetchContacts with this more robust version\r\nasync function fetchContacts(signal?: AbortSignal | null) {\r\n  const tried: string[] = [];\r\n\r\n  // helper: normalize a raw user/contact object into ContactItem shape\r\n  function normalizeRaw(raw: any): ContactItem | null {\r\n    if (!raw) return null;\r\n    // try many common locations for id/name/email/phone and verified flags\r\n    const id = raw.id ?? raw.userId ?? raw.contactId ?? raw._id ?? null;\r\n    const name =\r\n      raw.name ??\r\n      raw.displayName ??\r\n      raw.fullName ??\r\n      (raw.profile && (raw.profile.displayName || raw.profile.name)) ??\r\n      raw.email ??\r\n      null;\r\n\r\n    // find email in several shapes\r\n    let email: string | null = null;\r\n    let emailVerified = false;\r\n    if (raw.email) {\r\n      email = raw.email;\r\n      // common boolean flag\r\n      emailVerified = Boolean(raw.emailVerified ?? raw.email_verified ?? (raw.profile && raw.profile.emailVerified) ?? false);\r\n    } else if (Array.isArray(raw.emails) && raw.emails.length) {\r\n      // e.g. [{ value:'x@', verified: true }]\r\n      const primary = raw.emails.find((e: any) => e.primary || e.primary === true) ?? raw.emails[0];\r\n      email = primary?.value ?? primary?.address ?? null;\r\n      emailVerified = Boolean(primary?.verified ?? primary?.verifiedAt ?? false);\r\n    } else if (Array.isArray(raw.accounts) && raw.accounts.length) {\r\n      // e.g. OAuth accounts [{ provider: 'google', email: 'x@' }]\r\n      const acct = raw.accounts.find((a: any) => a.provider && (a.email || a.profile?.email)) ?? raw.accounts[0];\r\n      email = acct?.email ?? acct?.profile?.email ?? null;\r\n      emailVerified = true; // assume oauth provider emails are verified\r\n    } else if (Array.isArray(raw.identities) && raw.identities.length) {\r\n      const idn = raw.identities.find(Boolean);\r\n      email = idn?.email ?? null;\r\n      emailVerified = Boolean(idn?.email_verified ?? true);\r\n    } else if (raw.profile && raw.profile.email) {\r\n      email = raw.profile.email;\r\n      emailVerified = Boolean(raw.profile.emailVerified ?? raw.profile.email_verified ?? false);\r\n    }\r\n\r\n    // find phone in several shapes\r\n    let phone: string | null = null;\r\n    let phoneVerified = false;\r\n    if (raw.phone) {\r\n      phone = raw.phone;\r\n      phoneVerified = Boolean(raw.phoneVerified ?? raw.phone_verified ?? (raw.profile && raw.profile.phoneVerified) ?? false);\r\n    } else if (raw.phoneNumber) {\r\n      phone = raw.phoneNumber;\r\n      phoneVerified = Boolean(raw.phoneVerified ?? false);\r\n    } else if (raw.profile && raw.profile.phoneNumber) {\r\n      phone = raw.profile.phoneNumber;\r\n      phoneVerified = Boolean(raw.profile.phoneVerified ?? false);\r\n    } else if (Array.isArray(raw.phones) && raw.phones.length) {\r\n      const p = raw.phones[0];\r\n      phone = p?.value ?? p?.number ?? null;\r\n      phoneVerified = Boolean(p?.verified ?? false);\r\n    }\r\n\r\n    if (!id && !email && !phone) {\r\n      // nothing useful here\r\n      return null;\r\n    }\r\n\r\n    return {\r\n      id: id ?? (email ?? phone) ?? String(Math.random()).slice(2, 9),\r\n      name,\r\n      email,\r\n      emailVerified,\r\n      phone,\r\n      phoneVerified,\r\n    };\r\n  }\r\n\r\n  // generic fetch helper that returns array or object\r\n  async function tryFetch(url: string) {\r\n    tried.push(url);\r\n    try {\r\n      const opts = signal ? { signal } : undefined;\r\n      const r = await fetch(url, opts as any);\r\n      if (!r.ok) {\r\n        console.debug(`[fetchContacts] ${url} returned ${r.status}`);\r\n        return null;\r\n      }\r\n      const j = await r.json().catch(() => null);\r\n      return j;\r\n    } catch (err) {\r\n      console.debug(`[fetchContacts] ${url} fetch error:`, err);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // order: contacts -> users -> me -> admin/users\r\n  const tries = [\"/api/contacts?limit=1000\", \"/api/users?limit=1000\", \"/api/me\", \"/api/admin/users?limit=1000\"];\r\n  let aggregated: any[] = [];\r\n\r\n  for (const url of tries) {\r\n    const data = await tryFetch(url);\r\n    if (!data) continue;\r\n\r\n    // /api/me returns { user }\r\n    if (data.user) {\r\n      const n = normalizeRaw(data.user);\r\n      if (n) aggregated.push(n);\r\n    } else if (Array.isArray(data)) {\r\n      for (const item of data) {\r\n        const n = normalizeRaw(item);\r\n        if (n) aggregated.push(n);\r\n      }\r\n    } else if (Array.isArray(data.contacts)) {\r\n      for (const item of data.contacts) {\r\n        const n = normalizeRaw(item);\r\n        if (n) aggregated.push(n);\r\n      }\r\n    } else if (Array.isArray((data as any).users)) {\r\n      for (const item of (data as any).users) {\r\n        const n = normalizeRaw(item);\r\n        if (n) aggregated.push(n);\r\n      }\r\n    } else if (typeof data === \"object\") {\r\n      // maybe it's a single user or object with items\r\n      if ((data as any).items && Array.isArray((data as any).items)) {\r\n        for (const item of (data as any).items) {\r\n          const n = normalizeRaw(item);\r\n          if (n) aggregated.push(n);\r\n        }\r\n      } else {\r\n        // single object\r\n        const n = normalizeRaw(data);\r\n        if (n) aggregated.push(n);\r\n      }\r\n    }\r\n\r\n    // if we found some items, break early (but still allow later fallback)\r\n    if (aggregated.length > 0) break;\r\n  }\r\n\r\n  // always also try to include the signed-in /api/me user to ensure they're visible\r\n  try {\r\n    const me = await tryFetch(\"/api/me\");\r\n    if (me && me.user) {\r\n      const n = normalizeRaw(me.user);\r\n      if (n) aggregated.push(n);\r\n    }\r\n  } catch (e) {}\r\n\r\n  // de-duplicate by id/email/phone\r\n  const map = new Map<string, ContactItem>();\r\n  for (const a of aggregated) {\r\n    const key = a.id ?? a.email ?? a.phone ?? JSON.stringify(a);\r\n    if (!map.has(key)) map.set(key, a);\r\n    else {\r\n      // merge existing\r\n      const ex = map.get(key)!;\r\n      map.set(key, { ...ex, ...a });\r\n    }\r\n  }\r\n\r\n  const result = Array.from(map.values());\r\n\r\n  // debug: if empty, log what we tried to help backend debugging\r\n  if (result.length === 0) {\r\n    console.warn(\"[fetchContacts] no contacts normalized — tried endpoints:\", tried);\r\n    console.warn(\"[fetchContacts] aggregated raw:\", aggregated.slice(0, 20));\r\n  } else {\r\n    console.debug(\"[fetchContacts] normalized contacts count:\", result.length);\r\n  }\r\n\r\n  setContacts((prev) => mergeUniqueContacts(prev, result));\r\n}\r\n\r\n\r\n  function mergeUniqueContacts(prev: ContactItem[], next: ContactItem[]) {\r\n    const map = new Map<string, ContactItem>();\r\n    // key by id primarily, else by email/phone\r\n    prev.forEach((c) => {\r\n      const key = c.id ?? c.email ?? c.phone ?? String(Math.random());\r\n      map.set(key, c);\r\n    });\r\n    next.forEach((c) => {\r\n      const key = c.id ?? c.email ?? c.phone ?? String(Math.random());\r\n      if (!map.has(key)) map.set(key, c);\r\n      else {\r\n        const existing = map.get(key)!;\r\n        map.set(key, { ...existing, ...c });\r\n      }\r\n    });\r\n    return Array.from(map.values());\r\n  }\r\n\r\n  // Realtime: open WebSocket to receive presence and new thread events\r\n  useEffect(() => {\r\n    if (!user) return;\r\n    let ws: WebSocket | null = null;\r\n    try {\r\n      ws = new WebSocket((typeof window !== \"undefined\" ? window.location.origin : \"\") + \"/api/ws\");\r\n      wsRef.current = ws;\r\n\r\n      ws.onopen = () => {\r\n        ws?.send(JSON.stringify({ type: \"hello\", userId: user.id, name: user.name }));\r\n      };\r\n\r\n      ws.onmessage = (ev) => {\r\n        try {\r\n          const msg = JSON.parse(ev.data);\r\n          if (msg.type === \"presence\") {\r\n            setPresence((p) => ({ ...p, [msg.userId]: { name: msg.name, idle: msg.idle } }));\r\n          }\r\n          if (msg.type === \"presence:leave\") {\r\n            setPresence((p) => {\r\n              const copy = { ...p };\r\n              delete copy[msg.userId];\r\n              return copy;\r\n            });\r\n          }\r\n          if (msg.type === \"thread:new\") {\r\n            setThreads((t) => [msg.thread as ThreadPreviewItem, ...t]);\r\n          }\r\n          if (msg.type === \"thread:update\") {\r\n            setThreads((t) => t.map((x) => (x.id === msg.thread.id ? msg.thread : x)));\r\n          }\r\n        } catch (e) {\r\n          console.warn(\"ws parse error\", e);\r\n        }\r\n      };\r\n\r\n      ws.onclose = () => {\r\n        wsRef.current = null;\r\n      };\r\n    } catch (e) {\r\n      console.warn(\"Realtime not available\", e);\r\n    }\r\n\r\n    return () => {\r\n      try {\r\n        ws?.close();\r\n      } catch (e) {\r\n        /* */\r\n      }\r\n    };\r\n  }, [user]);\r\n\r\n  function handlePrimary() {\r\n    if (isAdmin) router.push(\"/admin\");\r\n    else router.push(\"/inbox\");\r\n  }\r\n\r\n  async function handleBuyNumber(id: string) {\r\n    setBuying(id);\r\n    try {\r\n      const res = await fetch(`/api/twilio/buy`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ id }),\r\n      });\r\n      if (!res.ok) throw new Error(\"failed to buy\");\r\n      // refresh numbers\r\n      const refreshed = await fetch(`/api/twilio/numbers`);\r\n      if (refreshed.ok) {\r\n        const j = await refreshed.json();\r\n        setNumbers(Array.isArray(j.numbers) ? j.numbers : []);\r\n      }\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(\"Failed to buy number. Check logs or sandbox mode.\");\r\n    } finally {\r\n      setBuying(null);\r\n    }\r\n  }\r\n\r\n  // open composer with optional context (threadId or contactId)\r\n  function openComposer(ctx?: { threadId?: string; contactId?: string }) {\r\n    if (!isEditor) {\r\n      // viewers cannot compose\r\n      return;\r\n    }\r\n    setComposerContext(ctx ?? null);\r\n    setComposerOpen(true);\r\n  }\r\n\r\n  function closeComposer() {\r\n    setComposerOpen(false);\r\n    setComposerContext(null);\r\n  }\r\n\r\n  // sendMessage handles immediate sends and scheduled sends\r\n  // improved sendMessage with detailed logging & clearer errors\r\nasync function sendMessage(payload: { to: string; channel: string; body: string; scheduleAt?: string; threadId?: string; contactId?: string }) {\r\n  if (!isEditor) throw new Error(\"not authorized\");\r\n\r\n  console.debug(\"[sendMessage] payload:\", payload);\r\n\r\n  // optimistic thread preview insertion (unchanged)\r\n  const isScheduled = !!payload.scheduleAt;\r\n  const optimistic: ThreadPreviewItem = {\r\n    id: isScheduled ? \"sched-\" + Math.random().toString(36).slice(2, 9) : \"tmp-\" + Math.random().toString(36).slice(2, 9),\r\n    contactId: payload.contactId,\r\n    contactName: payload.to,\r\n    contactPhone: payload.to,\r\n    channels: [payload.channel],\r\n    snippet: payload.body,\r\n    lastAt: new Date().toISOString(),\r\n    scheduled: isScheduled,\r\n  };\r\n  setThreads((t) => [optimistic, ...t]);\r\n\r\n  try {\r\n    let res: Response;\r\n    let endpoint: string;\r\n    if (isScheduled) {\r\n      endpoint = \"/api/messages/schedule\";\r\n      res = await fetch(endpoint, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          to: payload.to,\r\n          channel: payload.channel,\r\n          body: payload.body,\r\n          sendAt: payload.scheduleAt,\r\n          threadId: payload.threadId,\r\n          contactId: payload.contactId,\r\n          metadata: { to: payload.to },\r\n        }),\r\n      });\r\n    } else {\r\n      endpoint = \"/api/messages/send\";\r\n      res = await fetch(endpoint, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          to: payload.to,\r\n          channel: payload.channel,\r\n          body: payload.body,\r\n          threadId: payload.threadId,\r\n          contactId: payload.contactId,\r\n          metadata: { to: payload.to },\r\n        }),\r\n      });\r\n    }\r\n\r\n    // read response text for debugging (attempt json, fallback to text)\r\n    const text = await res.text().catch(() => \"\");\r\n    let parsed: any = null;\r\n    try {\r\n      parsed = text ? JSON.parse(text) : null;\r\n    } catch (e) {\r\n      parsed = text;\r\n    }\r\n\r\n    console.debug(`[sendMessage] ${endpoint} responded status=${res.status}`, parsed);\r\n\r\n    if (!res.ok) {\r\n      // remove optimistic preview\r\n      setThreads((t) => t.filter((x) => !x.id.startsWith(\"tmp-\") && !x.id.startsWith(\"sched-\")));\r\n      const serverMsg = parsed?.error ?? parsed?.message ?? (typeof parsed === \"string\" ? parsed : `HTTP ${res.status}`);\r\n      // show a helpful alert and throw the server message so UI caller can react\r\n      alert(`Send failed: ${serverMsg}`);\r\n      throw new Error(`send failed: ${serverMsg}`);\r\n    }\r\n\r\n    const j = parsed ?? {};\r\n\r\n    // if server returns canonical thread, replace optimistic\r\n    if (j.thread && j.thread.id) {\r\n      setThreads((t) => [j.thread as ThreadPreviewItem, ...t.filter((x) => !x.id.startsWith(\"tmp-\") && !x.id.startsWith(\"sched-\"))]);\r\n    } else {\r\n      // fallback: remove tmp optimistic\r\n      setThreads((t) => t.filter((x) => !x.id.startsWith(\"tmp-\")));\r\n    }\r\n\r\n    return j;\r\n  } catch (err) {\r\n    // already removed optimistic on non-ok responses; ensure optimistic removed on any thrown error\r\n    setThreads((t) => t.filter((x) => !x.id.startsWith(\"tmp-\") && !x.id.startsWith(\"sched-\")));\r\n    console.error(\"[sendMessage] error:\", err);\r\n    throw err;\r\n  }\r\n}\r\n\r\n\r\n  return (\r\n    <main className=\"min-h-screen bg-gradient-to-b from-slate-50 via-white to-slate-50\">\r\n      <div className=\"max-w-7xl mx-auto px-6 py-8\">\r\n        {/* header */}\r\n        <div className=\"flex items-center justify-between mb-6\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <div className=\"h-12 w-12 rounded-xl bg-gradient-to-br from-blue-600 to-indigo-600 flex items-center justify-center shadow-md\">\r\n              <svg width=\"26\" height=\"26\" viewBox=\"0 0 24 24\" fill=\"none\" aria-hidden>\r\n                <path d=\"M3 12h18\" stroke=\"white\" strokeWidth=\"2\" strokeLinecap=\"round\" />\r\n                <path d=\"M7 6v12\" stroke=\"white\" strokeWidth=\"2\" strokeLinecap=\"round\" />\r\n              </svg>\r\n            </div>\r\n            <div>\r\n              <div className=\"text-lg font-semibold text-slate-900\">SignalHub</div>\r\n              <div className=\"text-xs text-slate-500\">Unified Inbox • Multi-channel outreach</div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex items-center gap-4\">\r\n            <div className=\"hidden sm:inline-flex items-center gap-2 rounded-full px-3 py-1 bg-slate-100 text-slate-800 text-sm\">\r\n              <strong className=\"uppercase\">{role}</strong>\r\n              <span className=\"text-xs text-slate-600\">access</span>\r\n            </div>\r\n\r\n            <div className=\"hidden md:flex items-center gap-2 text-xs text-slate-600\">\r\n              {/* presence */}\r\n              <div className=\"flex items-center gap-2\">\r\n                {Object.keys(presence).length === 0 ? (\r\n                  <span className=\"text-xs text-slate-400\">no one online</span>\r\n                ) : (\r\n                  <div className=\"flex items-center gap-2\">\r\n                    {Object.entries(presence).slice(0, 4).map(([id, p]) => (\r\n                      <div key={id} className=\"flex items-center gap-1\">\r\n                        <span className={`w-2 h-2 rounded-full ${p.idle ? \"bg-yellow-400\" : \"bg-green-400\"}`} />\r\n                        <span title={p.name}>{p.name ?? id}</span>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            <ProfileMenu email={user?.email} avatarUrl={undefined} />\r\n          </div>\r\n        </div>\r\n\r\n        {/* hero + features */}\r\n        <header className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 items-start mb-8\">\r\n          <div className=\"lg:col-span-2\">\r\n            <div className=\"bg-white/60 backdrop-blur-md rounded-3xl p-8 shadow-lg border border-slate-100\">\r\n              <div className=\"flex items-start gap-6\">\r\n                <div className=\"flex-shrink-0\">\r\n                  <div className=\"h-14 w-14 rounded-xl bg-gradient-to-br from-blue-600 to-indigo-600 flex items-center justify-center shadow-md\">\r\n                    <svg width=\"28\" height=\"28\" viewBox=\"0 0 24 24\" fill=\"none\" aria-hidden>\r\n                      <path d=\"M3 12h18\" stroke=\"white\" strokeWidth=\"2\" strokeLinecap=\"round\" />\r\n                      <path d=\"M7 6v12\" stroke=\"white\" strokeWidth=\"2\" strokeLinecap=\"round\" />\r\n                    </svg>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"flex-1\">\r\n                  <h1 className=\"text-3xl sm:text-4xl font-extrabold tracking-tight text-slate-900\">\r\n                    SignalHub — Unified Inbox for Multi-Channel Outreach\r\n                  </h1>\r\n                  <p className=\"mt-3 text-slate-600 max-w-2xl\">\r\n                    Manage SMS, WhatsApp and Email threads in one place, collaborate with your team in\r\n                    real time, schedule messages, and measure impact — built with secure webhooks and\r\n                    role-based controls.\r\n                  </p>\r\n\r\n                  <div className=\"mt-6 flex flex-wrap gap-3 items-center\">\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={handlePrimary}\r\n                      className=\"inline-flex items-center gap-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-2 rounded-lg shadow hover:scale-[1.01] transition-transform\"\r\n                    >\r\n                      {isAdmin ? \"Open Admin Dashboard\" : \"Go to Inbox\"}\r\n                      <svg className=\"w-4 h-4\" viewBox=\"0 0 24 24\" fill=\"none\" aria-hidden>\r\n                        <path d=\"M5 12h14\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" />\r\n                        <path d=\"M12 5l7 7-7 7\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" />\r\n                      </svg>\r\n                    </button>\r\n\r\n                    <Link href=\"/settings\" className=\"px-4 py-2 rounded-lg border text-slate-700 hover:bg-slate-50\">\r\n                      Configure Integrations\r\n                    </Link>\r\n\r\n                    {isEditor && (\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => openComposer()}\r\n                        className=\"px-4 py-2 rounded-lg border bg-white text-slate-700 hover:bg-slate-50\"\r\n                      >\r\n                        Quick Compose\r\n                      </button>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* quick feature cards */}\r\n              <div className=\"mt-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3\">\r\n                <FeatureCard\r\n                  title=\"Unified Threads\"\r\n                  desc=\"All messages normalized into threads per contact — SMS, WhatsApp, Email. Click a thread to preview.\"\r\n                />\r\n                <FeatureCard\r\n                  title=\"Schedule & Automate\"\r\n                  desc=\"Schedule outbound messages and run background workers for timed delivery.\"\r\n                />\r\n                <FeatureCard\r\n                  title=\"Team Collaboration\"\r\n                  desc=\"Real-time presence, shared notes, and role-based permissions.\"\r\n                />\r\n                <FeatureCard\r\n                  title=\"Analytics\"\r\n                  desc=\"Quick insights: volume, response time and delivery KPIs. Exportable CSVs.\"\r\n                />\r\n              </div>\r\n\r\n              {/* twilio sandbox status + numbers */}\r\n              <div className=\"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div className=\"rounded-xl border border-rose-50 p-4 bg-rose-50/30\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                      <div className=\"text-sm font-semibold\">Twilio Sandbox</div>\r\n                      <div className=\"text-xs text-slate-600\">Trial mode — numbers are simulated unless purchased</div>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-500\">Sandbox</div>\r\n                  </div>\r\n\r\n                  <div className=\"mt-3\">\r\n                    <div className=\"text-xs text-slate-700 mb-2\">Available numbers</div>\r\n                    <div className=\"space-y-2\">\r\n                      {numbers.length === 0 ? (\r\n                        <div className=\"text-xs text-slate-500\">No sandbox numbers found.</div>\r\n                      ) : (\r\n                        numbers.slice(0, 4).map((n) => (\r\n                          <div key={n.id} className=\"flex items-center justify-between bg-white rounded-lg p-2 border\">\r\n                            <div>\r\n                              <div className=\"font-medium\">{n.phone}</div>\r\n                              <div className=\"text-xs text-slate-500\">\r\n                                {n.provider} • {n.capabilities ? Object.keys(n.capabilities).filter((k) => n.capabilities?.[k]).join(\", \") : \"—\"}\r\n                              </div>\r\n                            </div>\r\n                            <div>\r\n                              {n.purchased ? (\r\n                                <span className=\"text-xs text-green-600\">Purchased</span>\r\n                              ) : (\r\n                                <button\r\n                                  type=\"button\"\r\n                                  onClick={() => handleBuyNumber(n.id)}\r\n                                  className=\"px-3 py-1 rounded bg-indigo-600 text-white text-xs\"\r\n                                  disabled={!!buying}\r\n                                >\r\n                                  {buying === n.id ? \"Buying…\" : \"Buy Now\"}\r\n                                </button>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                        ))\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <IntegrationsPanel numbers={numbers} />\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* right column: analytics + quick stats */}\r\n          <aside className=\"space-y-4\">\r\n            <AnalyticsPanel analytics={analytics} loading={loading} />\r\n\r\n            {/* Quick actions card */}\r\n            <div className=\"bg-white rounded-2xl p-4 shadow-sm border border-slate-100\">\r\n              <h4 className=\"text-sm font-semibold text-slate-700 mb-2\">Quick actions</h4>\r\n              <div className=\"flex flex-col gap-2\">\r\n                <button\r\n                  type=\"button\"\r\n                  className={`text-left px-3 py-2 rounded-lg ${isEditor ? \"bg-blue-50\" : \"bg-slate-50 text-slate-500 cursor-not-allowed\"}`}\r\n                  onClick={() => (isEditor ? openComposer() : null)}\r\n                  aria-disabled={!isEditor}\r\n                >\r\n                  Compose message {isEditor ? \"\" : \"(editor required)\"}\r\n                </button>\r\n                <button\r\n                  type=\"button\"\r\n                  className={`text-left px-3 py-2 rounded-lg ${isAdmin ? \"bg-indigo-50\" : \"bg-slate-50 text-slate-500 cursor-not-allowed\"}`}\r\n                  onClick={() => (isAdmin ? router.push(\"/admin\") : null)}\r\n                  aria-disabled={!isAdmin}\r\n                >\r\n                  Manage team {isAdmin ? \"\" : \"(admin only)\"}\r\n                </button>\r\n                <Link className=\"text-left px-3 py-2 rounded-lg bg-slate-50\" href=\"/analytics\">\r\n                  View analytics\r\n                </Link>\r\n                <Link className=\"text-left px-3 py-2 rounded-lg bg-slate-50\" href=\"/settings\">\r\n                  Integrations & webhooks\r\n                </Link>\r\n              </div>\r\n            </div>\r\n          </aside>\r\n        </header>\r\n\r\n        {/* middle: thread preview + tasks */}\r\n        <section className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n          <div className=\"lg:col-span-2 bg-white rounded-3xl p-6 shadow border border-slate-100\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <h2 className=\"text-lg font-semibold\">Live thread preview</h2>\r\n              <div className=\"text-sm text-slate-500\">Normalized view • unified timeline</div>\r\n            </div>\r\n\r\n            <div className=\"rounded-xl overflow-hidden border border-slate-100\">\r\n              <div className=\"p-4 bg-gradient-to-r from-slate-50 to-white\">\r\n                <ThreadsList\r\n                  threads={threads}\r\n                  onOpenContact={(id) => setContactModal({ contactId: id })}\r\n                  onCompose={(t) => openComposer({ threadId: t?.id, contactId: t?.contactId })}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"mt-6 text-sm text-slate-600\">\r\n              This preview demonstrates how inbound messages from different channels are shown\r\n              as one thread per contact. The composer is role-gated — viewers can only\r\n              read, editors can send/schedule, admins can manage settings & team.\r\n            </div>\r\n          </div>\r\n\r\n          <aside className=\"bg-white rounded-3xl p-6 shadow border border-slate-100\">\r\n            <h3 className=\"text-sm font-semibold mb-3\">Get started — suggested next steps</h3>\r\n\r\n            <ol className=\"text-sm space-y-3 list-decimal list-inside text-slate-700\">\r\n              <li>\r\n                Open <Link href=\"/inbox\" className=\"text-blue-600\">Inbox</Link> and review threads.\r\n              </li>\r\n              <li>{isEditor ? \"Compose and schedule a test message.\" : \"Request editor access to send messages.\"}</li>\r\n              <li>Verify Twilio Sandbox under <Link href=\"/settings\" className=\"text-blue-600\">Settings</Link>.</li>\r\n              <li>{isAdmin ? <><Link href=\"/admin\" className=\"text-blue-600\">Manage team</Link> & set roles.</> : \"Ask an admin to add you to a team.\"}</li>\r\n              <li>Open <Link href=\"/analytics\" className=\"text-blue-600\">Analytics</Link> to review KPIs.</li>\r\n            </ol>\r\n\r\n            <div className=\"mt-6\">\r\n              <Link href=\"/inbox\" className=\"block text-center bg-blue-600 text-white px-4 py-2 rounded-lg\">\r\n                Start working\r\n              </Link>\r\n            </div>\r\n          </aside>\r\n        </section>\r\n\r\n        <footer className=\"mt-12 text-center text-sm text-slate-500\">\r\n          Built for the Attack Capital assignment — multi-channel outreach, scheduling, team\r\n          collaboration and analytics.\r\n        </footer>\r\n\r\n        {/* Composer Modal */}\r\n        {composerOpen && (\r\n          <ComposerModal\r\n            onClose={closeComposer}\r\n            onSent={() => {\r\n              closeComposer();\r\n            }}\r\n            onSend={async (p) => {\r\n              // the ComposerModal now supplies to, channel, body and contactId\r\n              const payload = {\r\n                to: p.to,\r\n                channel: p.channel,\r\n                body: p.body,\r\n                scheduleAt: p.scheduleAt,\r\n                threadId: composerContext?.threadId,\r\n                contactId: p.contactId ?? composerContext?.contactId,\r\n              };\r\n              return sendMessage(payload);\r\n            }}\r\n            context={composerContext}\r\n            contacts={contacts}\r\n          />\r\n        )}\r\n\r\n        {/* Contact modal */}\r\n        {contactModal && (\r\n          <ContactProfileModal contactId={contactModal.contactId} onClose={() => setContactModal(null)} isEditor={isEditor} />\r\n        )}\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n\r\n/* ----------------------------- Small components ---------------------------- */\r\n\r\nfunction FeatureCard({ title, desc }: { title: string; desc: string }) {\r\n  return (\r\n    <div className=\"bg-white rounded-xl p-4 shadow-sm border border-slate-100 flex items-start gap-4\">\r\n      <div className=\"w-10 h-10 rounded-lg bg-slate-100 flex items-center justify-center\">\r\n        <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" aria-hidden>\r\n          <path d=\"M4 7h16M4 12h10M4 17h7\" stroke=\"#0f172a\" strokeWidth=\"1.6\" strokeLinecap=\"round\" />\r\n        </svg>\r\n      </div>\r\n      <div>\r\n        <div className=\"text-sm font-semibold text-slate-800\">{title}</div>\r\n        <div className=\"text-xs text-slate-500 mt-1\">{desc}</div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction ThreadsList({ threads, onOpenContact, onCompose }: { threads: any[]; onOpenContact: (id: string) => void; onCompose?: (t?: any) => void }) {\r\n  if (!Array.isArray(threads) || threads.length === 0) {\r\n    return <div className=\"p-6 text-sm text-slate-500\">No recent threads yet.</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"divide-y\">\r\n      {threads.map((t) => {\r\n        // dev-only logging for malformed objects\r\n        if (process.env.NODE_ENV !== \"production\") {\r\n          if (t && !Array.isArray(t.channels)) {\r\n            // eslint-disable-next-line no-console\r\n            console.debug(\"ThreadsList: thread has missing/invalid channels field:\", t);\r\n          }\r\n        }\r\n\r\n        const contactPhone = t?.contactPhone ?? \"—\";\r\n        const channelsDisplay = (Array.isArray(t?.channels) ? t.channels : []).join(\" • \") || \"—\";\r\n        const lastAtDisplay = t?.lastAt ? new Date(t.lastAt).toLocaleString() : \"—\";\r\n        const snippet = t?.snippet ?? \"\";\r\n\r\n        return (\r\n          <div key={t?.id ?? Math.random()} className=\"p-3 hover:bg-slate-50 flex items-start justify-between gap-4\">\r\n            <div className=\"flex-1\">\r\n              <div className=\"flex items-start justify-between\">\r\n                <div>\r\n                  <div className=\"font-medium\">{t?.contactName ?? \"Unknown\"}</div>\r\n                  <div className=\"text-xs text-slate-500\">\r\n                    {contactPhone} • {channelsDisplay}\r\n                  </div>\r\n                </div>\r\n                <div className=\"text-xs text-slate-400\">{lastAtDisplay}</div>\r\n              </div>\r\n              <div className=\"mt-2 text-sm text-slate-700\">{snippet}</div>\r\n              {t?.scheduled && <div className=\"mt-2 text-xs text-amber-600\">Scheduled</div>}\r\n            </div>\r\n\r\n            <div className=\"flex flex-col items-end gap-2\">\r\n              <button type=\"button\" onClick={() => onOpenContact(t?.contactId ?? t?.id)} className=\"text-xs px-3 py-1 rounded bg-slate-50\">Profile</button>\r\n              <button type=\"button\" onClick={() => (onCompose ? onCompose(t) : null)} className=\"text-xs px-3 py-1 rounded bg-indigo-600 text-white\">Reply</button>\r\n            </div>\r\n          </div>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\nfunction IntegrationsPanel({ numbers }: { numbers: ProviderNumber[] }) {\r\n  return (\r\n    <div className=\"rounded-xl border p-4 bg-white\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <div className=\"text-sm font-semibold\">Integration status</div>\r\n          <div className=\"text-xs text-slate-600\">Connected providers & webhook health</div>\r\n        </div>\r\n        <div className=\"text-xs text-slate-500\">OK</div>\r\n      </div>\r\n\r\n      <div className=\"mt-3 text-sm text-slate-700\">\r\n        Twilio (Sandbox) — Webhook configured\r\n        <div className=\"mt-2 text-xs text-slate-500\">Resend (Email) — Not connected</div>\r\n        <div className=\"mt-2 text-xs text-slate-500\">Available numbers: {numbers.length}</div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction AnalyticsPanel({ analytics, loading }: { analytics: AnalyticsSummary | null; loading: boolean }) {\r\n  return (\r\n    <div className=\"bg-white rounded-2xl p-4 shadow-sm border border-slate-100\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <h3 className=\"text-sm font-semibold text-slate-700\">Last 7 days</h3>\r\n        <span className=\"text-xs text-slate-500\">{loading ? \"Loading…\" : \"Updated\"}</span>\r\n      </div>\r\n\r\n      <div className=\"mt-3\">\r\n        <div className=\"flex items-end gap-6\">\r\n          <div>\r\n            <div className=\"text-2xl font-bold\">{analytics?.messages7d ?? \"—\"}</div>\r\n            <div className=\"text-xs text-slate-500\">Messages</div>\r\n          </div>\r\n          <div>\r\n            <div className=\"text-2xl font-bold\">{analytics?.avgResponseMins ?? \"—\"}m</div>\r\n            <div className=\"text-xs text-slate-500\">Avg response</div>\r\n          </div>\r\n          <div>\r\n            <div className=\"text-2xl font-bold\">{analytics?.openRatePct ?? \"—\"}%</div>\r\n            <div className=\"text-xs text-slate-500\">Open rate</div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"mt-4\">\r\n          <Sparkline data={analytics?.sparkline ?? [1, 2, 3, 2, 4]} />\r\n        </div>\r\n\r\n        <div className=\"mt-4 text-xs text-slate-500\">View full analytics for channel breakdown, response time histograms, and exportable reports.</div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ----------------------------- Contact modal + Yjs notes ---------------------------- */\r\n\r\nfunction ContactProfileModal({ contactId, onClose, isEditor }: { contactId: string; onClose: () => void; isEditor: boolean }) {\r\n  const [loading, setLoading] = useState(true);\r\n  const [contact, setContact] = useState<any | null>(null);\r\n  const [notes, setNotes] = useState<any[]>([]);\r\n  const [adding, setAdding] = useState(false);\r\n  const [noteText, setNoteText] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    const controller = new AbortController();\r\n    const signal = controller.signal;\r\n\r\n    async function load() {\r\n      try {\r\n        const [cRes, nRes] = await Promise.all([\r\n          fetch(`/api/contacts/${contactId}`, { signal }),\r\n          fetch(`/api/contacts/${contactId}/notes`, { signal }),\r\n        ]);\r\n        if (!mounted) return;\r\n        if (cRes.ok) {\r\n          const cj = await cRes.json();\r\n          setContact(cj.contact ?? cj);\r\n        }\r\n        if (nRes.ok) {\r\n          const nj = await nRes.json();\r\n          setNotes(Array.isArray(nj) ? nj : (nj.notes || []));\r\n        }\r\n      } catch (e) {\r\n        if ((e as any).name !== \"AbortError\") console.error(e);\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    }\r\n\r\n    load();\r\n    return () => {\r\n      mounted = false;\r\n      controller.abort();\r\n    };\r\n  }, [contactId]);\r\n\r\n  async function handleAddNote() {\r\n    if (!noteText.trim()) return;\r\n    setAdding(true);\r\n    try {\r\n      const res = await fetch(`/api/contacts/${contactId}/notes`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ body: noteText }),\r\n      });\r\n      if (!res.ok) throw new Error(\"failed to add note\");\r\n      const j = await res.json();\r\n      setNotes((s) => [j, ...s]);\r\n      setNoteText(\"\");\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(\"Failed to add note\");\r\n    } finally {\r\n      setAdding(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\r\n      <div className=\"absolute inset-0 bg-black/40\" onClick={onClose} />\r\n      <div className=\"relative max-w-3xl w-full bg-white rounded-2xl p-6 shadow-lg z-10\">\r\n        <div className=\"flex items-start justify-between\">\r\n          <h3 className=\"text-lg font-semibold\">Contact profile</h3>\r\n          <button type=\"button\" onClick={onClose} className=\"text-sm text-slate-500\">Close</button>\r\n        </div>\r\n\r\n        {loading ? (\r\n          <div className=\"mt-4\">Loading…</div>\r\n        ) : (\r\n          <div className=\"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            <div className=\"md:col-span-2\">\r\n              <div className=\"text-sm font-semibold\">{contact?.name ?? contact?.phone ?? \"Contact\"}</div>\r\n              <div className=\"text-xs text-slate-500 mt-1\">{contact?.email ?? \"—\"}</div>\r\n\r\n              <div className=\"mt-4\">\r\n                <div className=\"text-sm font-medium\">Notes (shared)</div>\r\n                <div className=\"mt-2\">\r\n                  <YjsNotes contactId={contactId} currentUser={{ id: \"me\", name: contact?.name ?? \"You\" }} />\r\n                </div>\r\n\r\n                <div className=\"mt-4\">\r\n                  <div className=\"text-sm font-medium\">Saved notes</div>\r\n                  <div className=\"mt-2 space-y-2\">\r\n                    {notes.length === 0 ? (\r\n                      <div className=\"text-xs text-slate-500\">No notes</div>\r\n                    ) : (\r\n                      notes.map((n) => (\r\n                        <div key={n.id} className=\"p-2 bg-slate-50 rounded\">{n.encrypted ? \"(encrypted)\" : n.body}</div>\r\n                      ))\r\n                    )}\r\n                  </div>\r\n\r\n                  {isEditor && (\r\n                    <div className=\"mt-4\">\r\n                      <textarea className=\"w-full rounded border px-3 py-2 mt-1\" rows={3} value={noteText} onChange={(e) => setNoteText(e.target.value)} placeholder=\"Add private note\" />\r\n                      <div className=\"mt-2 flex justify-end\">\r\n                        <button type=\"button\" onClick={handleAddNote} disabled={adding || !noteText.trim()} className=\"px-3 py-1 rounded bg-blue-600 text-white text-sm\">{adding ? \"Adding…\" : \"Add note\"}</button>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"md:col-span-1\">\r\n              <div className=\"text-sm font-medium\">Quick actions</div>\r\n              <div className=\"mt-2 flex flex-col gap-2\">\r\n                <Link href={`/inbox?contact=${contactId}`} className=\"px-3 py-2 rounded bg-blue-600 text-white text-sm text-center\">Open thread</Link>\r\n                <button type=\"button\" className=\"px-3 py-2 rounded bg-slate-50 text-sm\">Merge duplicates</button>\r\n                <button type=\"button\" className=\"px-3 py-2 rounded bg-slate-50 text-sm\">Export contact</button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ----------------------------- Composer (send + schedule) ---------------------------- */\r\n\r\n/**\r\n * ComposerModal props:\r\n * - contacts: preloaded contacts array (used to populate the \"To\" selector)\r\n * - context.contactId: optional contact to pre-select\r\n */\r\nfunction ComposerModal({\r\n  onClose,\r\n  onSent,\r\n  onSend,\r\n  context,\r\n  contacts,\r\n}: {\r\n  onClose: () => void;\r\n  onSent?: (p?: any) => void;\r\n  onSend: (payload: { to: string; channel: string; body: string; scheduleAt?: string; contactId?: string }) => Promise<any>;\r\n  context?: { threadId?: string; contactId?: string } | null;\r\n  contacts: ContactItem[];\r\n}) {\r\n  // `to` state holds the selected actual address (phone or email) string\r\n  const [to, setTo] = useState<string>(\"\");\r\n  // `selectedContactId` stores which contact is selected (if any)\r\n  const [selectedContactId, setSelectedContactId] = useState<string | undefined>(undefined);\r\n\r\n  // channel selection\r\n  const [channel, setChannel] = useState<\"SMS\" | \"WHATSAPP\" | \"EMAIL\">(\"SMS\");\r\n\r\n  const [body, setBody] = useState(\"\");\r\n  const [sending, setSending] = useState(false);\r\n  const [sendMode, setSendMode] = useState<\"now\" | \"schedule\">(\"now\");\r\n  const [sendAt, setSendAt] = useState<string | null>(null);\r\n\r\n  // Keep a local filtered list derived from contacts\r\n  const phoneOptions = useMemo(\r\n    () =>\r\n      contacts\r\n        .filter((c) => c.phone && c.phoneVerified)\r\n        .map((c) => ({ contactId: c.id, label: `${c.name ?? c.phone} (${c.phone})`, value: c.phone })),\r\n    [contacts]\r\n  );\r\n\r\n  const emailOptions = useMemo(\r\n    () =>\r\n      contacts\r\n        .filter((c) => c.email && (c.emailVerified ?? true)) // if backend doesn't provide emailVerified, include if email exists\r\n        .map((c) => ({ contactId: c.id, label: `${c.name ?? c.email} (${c.email})`, value: c.email })),\r\n    [contacts]\r\n  );\r\n\r\n  // If composer opened with context.contactId, pre-select sensible default based on channel\r\n  useEffect(() => {\r\n    if (!context?.contactId) return;\r\n    const c = contacts.find((x) => x.id === context.contactId);\r\n    if (!c) return;\r\n\r\n    if ((channel === \"SMS\" || channel === \"WHATSAPP\") && c.phone) {\r\n      if (c.phoneVerified) {\r\n        setTo(c.phone);\r\n        setSelectedContactId(c.id);\r\n      } else {\r\n        // don't prefill unverified number — leave selection blank\r\n      }\r\n    } else if (channel === \"EMAIL\" && c.email) {\r\n      setTo(c.email);\r\n      setSelectedContactId(c.id);\r\n    } else {\r\n      // if channel doesn't match contact's preferred, try to pick a best-match\r\n      if (channel === \"EMAIL\" && c.email) {\r\n        setTo(c.email);\r\n        setSelectedContactId(c.id);\r\n      } else if ((channel === \"SMS\" || channel === \"WHATSAPP\") && c.phone) {\r\n        if (c.phoneVerified) {\r\n          setTo(c.phone);\r\n          setSelectedContactId(c.id);\r\n        }\r\n      }\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [context?.contactId, contacts, channel]);\r\n\r\n  // When channel changes, clear selection if it no longer matches\r\n  useEffect(() => {\r\n    if (!to) return;\r\n    const isPhoneChannel = channel === \"SMS\" || channel === \"WHATSAPP\";\r\n    const contactHasMatch = contacts.find((c) => {\r\n      if (isPhoneChannel) return c.phone === to && c.phoneVerified;\r\n      else return c.email === to;\r\n    });\r\n    if (!contactHasMatch) {\r\n      // clear selection — forces user to pick a valid contact for the channel\r\n      setTo(\"\");\r\n      setSelectedContactId(undefined);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [channel]);\r\n\r\n  // Handler when user picks an item from the select\r\n  function onSelectTo(e: React.ChangeEvent<HTMLSelectElement>) {\r\n    const val = e.target.value;\r\n    if (!val) {\r\n      setTo(\"\");\r\n      setSelectedContactId(undefined);\r\n      return;\r\n    }\r\n\r\n    // The option value is encoded as JSON: {contactId, value}\r\n    try {\r\n      const parsed = JSON.parse(val);\r\n      setTo(parsed.value);\r\n      setSelectedContactId(parsed.contactId);\r\n    } catch (err) {\r\n      // fallback: plain value\r\n      setTo(val);\r\n      setSelectedContactId(undefined);\r\n    }\r\n  }\r\n  // --- paste here, before your component ---\r\nasync function debugSendMessage(payload: {\r\n  to: string;\r\n  channel: string;\r\n  body: string;\r\n  scheduleAt?: string;\r\n  threadId?: string;\r\n  contactId?: string;\r\n}) {\r\n  try {\r\n    const res = await fetch(\"/api/messages/send\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify(payload),\r\n      credentials: \"include\",\r\n    });\r\n\r\n    let body: any = null;\r\n    try {\r\n      body = await res.json().catch(() => null);\r\n    } catch {\r\n      body = null;\r\n    }\r\n\r\n    if (!res.ok) {\r\n      console.error(\r\n        \"send failed:\",\r\n        res.status,\r\n        body ?? (await res.text().catch(() => \"(no body)\"))\r\n      );\r\n      const msg =\r\n        (body && (body.error || body.message)) ||\r\n        `Send failed (HTTP ${res.status}). See console for details.`;\r\n      throw new Error(msg);\r\n    }\r\n\r\n    return body;\r\n  } catch (err: any) {\r\n    console.error(\"send failed (network/internal):\", err);\r\n    throw err;\r\n  }\r\n}\r\n\r\n\r\n  async function handleSend() {\r\n    setSending(true);\r\n    try {\r\n      // ensure required fields\r\n      if (!to) {\r\n        alert(\"Select a recipient in the To field.\");\r\n        setSending(false);\r\n        return;\r\n      }\r\n      if (!body.trim()) {\r\n        alert(\"Message body is required.\");\r\n        setSending(false);\r\n        return;\r\n      }\r\n\r\n      const payload = {\r\n        to,\r\n        channel,\r\n        body,\r\n        scheduleAt: sendMode === \"schedule\" && sendAt ? sendAt : undefined,\r\n        contactId: selectedContactId,\r\n      };\r\n      await onSend(payload);\r\n      onSent?.(payload);\r\n      onClose();\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(\"Failed to send message\");\r\n    } finally {\r\n      setSending(false);\r\n    }\r\n  }\r\n\r\n  // Build the options list for current channel\r\n  const currentOptions = useMemo(() => {\r\n    if (channel === \"EMAIL\") {\r\n      // include email options\r\n      return emailOptions.map((o) => ({ label: o.label, value: JSON.stringify({ contactId: o.contactId, value: o.value }) }));\r\n    } else {\r\n      // SMS or WHATSAPP -> phones only\r\n      return phoneOptions.map((o) => ({ label: o.label, value: JSON.stringify({ contactId: o.contactId, value: o.value }) }));\r\n    }\r\n  }, [channel, phoneOptions, emailOptions]);\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\r\n      <div className=\"absolute inset-0 bg-black/40\" onClick={onClose} />\r\n      <div className=\"relative max-w-2xl w-full bg-white rounded-2xl p-6 shadow-lg z-10\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <h3 className=\"text-lg font-semibold\">Compose message</h3>\r\n          <button type=\"button\" onClick={onClose} className=\"text-sm text-slate-500\">Close</button>\r\n        </div>\r\n\r\n        <div className=\"mt-4 space-y-3\">\r\n          <div>\r\n            <label className=\"text-xs text-slate-600\">To</label>\r\n\r\n            {/* SELECT field (required) */}\r\n            <select\r\n              className=\"w-full rounded border px-3 py-2 mt-1\"\r\n              value={to ? JSON.stringify({ contactId: selectedContactId ?? null, value: to }) : \"\"}\r\n              onChange={onSelectTo}\r\n            >\r\n              <option value=\"\">— select recipient —</option>\r\n              {currentOptions.length === 0 ? (\r\n                <option value=\"\" disabled>\r\n                  No verified recipients for {channel === \"EMAIL\" ? \"email\" : \"phone/WhatsApp\"}\r\n                </option>\r\n              ) : (\r\n                currentOptions.map((opt, i) => (\r\n                  <option key={i} value={opt.value}>\r\n                    {opt.label}\r\n                  </option>\r\n                ))\r\n              )}\r\n            </select>\r\n\r\n            <div className=\"text-xs text-slate-400 mt-1\">\r\n              Choose a verified recipient. For {channel === \"EMAIL\" ? \"emails\" : \"phones/WhatsApp\"}, only verified addresses are shown.\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-2 gap-3\">\r\n            <div>\r\n              <label className=\"text-xs text-slate-600\">Channel</label>\r\n              <select className=\"w-full rounded border px-3 py-2 mt-1\" value={channel} onChange={(e) => setChannel(e.target.value as any)}>\r\n                <option value=\"SMS\">SMS</option>\r\n                <option value=\"WHATSAPP\">WhatsApp</option>\r\n                <option value=\"EMAIL\">Email</option>\r\n              </select>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"text-xs text-slate-600\">Send</label>\r\n              <select className=\"w-full rounded border px-3 py-2 mt-1\" value={sendMode} onChange={(e) => setSendMode(e.target.value as any)}>\r\n                <option value=\"now\">Send now</option>\r\n                <option value=\"schedule\">Schedule</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n\r\n          {sendMode === \"schedule\" && (\r\n            <div>\r\n              <label className=\"text-xs text-slate-600\">Send at</label>\r\n              <input className=\"w-full rounded border px-3 py-2 mt-1\" type=\"datetime-local\" value={sendAt ?? \"\"} onChange={(e) => setSendAt(e.target.value)} />\r\n              <div className=\"text-xs text-slate-400 mt-1\">Scheduled messages will be executed by the scheduler worker at the selected time.</div>\r\n            </div>\r\n          )}\r\n\r\n          <div>\r\n            <label className=\"text-xs text-slate-600\">Message</label>\r\n            <textarea className=\"w-full rounded border px-3 py-2 mt-1\" rows={4} value={body} onChange={(e) => setBody(e.target.value)} />\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-end gap-2\">\r\n            <button type=\"button\" onClick={onClose} className=\"px-4 py-2 rounded border\">Cancel</button>\r\n            <button type=\"button\" onClick={handleSend} disabled={sending || !to || !body} className=\"px-4 py-2 rounded bg-indigo-600 text-white\">\r\n              {sending ? \"Sending…\" : sendMode === \"now\" ? \"Send\" : \"Schedule\"}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ----------------------------- YjsNotes (lightweight) ---------------------------- */\r\n\r\nfunction YjsNotes({ contactId, currentUser }: { contactId: string; currentUser: { id?: string; name?: string } }) {\r\n  const [text, setText] = useState(\"\");\r\n  const ydocRef = useRef<Y.Doc | null>(null);\r\n  const providerRef = useRef<WebsocketProvider | null>(null);\r\n\r\n  useEffect(() => {\r\n    const wsUrl = process.env.NEXT_PUBLIC_YJS_WS || \"ws://localhost:1234\";\r\n    const doc = new Y.Doc();\r\n    ydocRef.current = doc;\r\n    const provider = new WebsocketProvider(wsUrl, `contact-notes-${contactId}`, doc);\r\n    providerRef.current = provider;\r\n\r\n    const ytext = doc.getText(\"notes\");\r\n    setText(ytext.toString());\r\n    const obs = () => setText(ytext.toString());\r\n    ytext.observe(obs);\r\n\r\n    provider.awareness.setLocalStateField(\"user\", { id: currentUser?.id, name: currentUser?.name ?? \"Unknown\" });\r\n\r\n    return () => {\r\n      try {\r\n        ytext.unobserve(obs);\r\n      } catch (e) {}\r\n      try {\r\n        provider.disconnect();\r\n      } catch (e) {}\r\n      doc.destroy();\r\n    };\r\n  }, [contactId, currentUser?.id, currentUser?.name]);\r\n\r\n  function onChangeLocal(e: React.ChangeEvent<HTMLTextAreaElement>) {\r\n    const doc = ydocRef.current;\r\n    if (!doc) return;\r\n    const ytext = doc.getText(\"notes\");\r\n    // replace entire text (simple approach)\r\n    ytext.delete(0, ytext.length);\r\n    ytext.insert(0, e.target.value);\r\n    setText(e.target.value);\r\n  }\r\n\r\n  async function saveSnapshotToDB() {\r\n    const doc = ydocRef.current;\r\n    if (!doc) return;\r\n    const ytext = doc.getText(\"notes\");\r\n    const val = ytext.toString();\r\n    try {\r\n      await fetch(`/api/contacts/${contactId}/notes`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ body: val }),\r\n      });\r\n      alert(\"Saved note snapshot\");\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(\"Failed to save\");\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <textarea className=\"w-full rounded border px-3 py-2 mt-1\" rows={6} value={text} onChange={onChangeLocal} />\r\n      <div className=\"flex justify-end mt-2 gap-2\">\r\n        <button onClick={saveSnapshotToDB} className=\"px-3 py-1 rounded bg-slate-50\">Save snapshot</button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ----------------------------- Sparkline ---------------------------- */\r\n\r\nfunction Sparkline({ data }: { data: number[] }) {\r\n  const width = 160;\r\n  const height = 40;\r\n  const max = Math.max(...data);\r\n  const min = Math.min(...data);\r\n  const points = data\r\n    .map((v, i) => {\r\n      const x = (i / (data.length - 1 || 1)) * width;\r\n      const y = height - ((v - min) / (max - min || 1)) * height;\r\n      return `${x},${y}`;\r\n    })\r\n    .join(\" \");\r\n\r\n  return (\r\n    <svg width={width} height={height} viewBox={`0 0 ${width} ${height}`} aria-hidden>\r\n      <polyline\r\n        fill=\"none\"\r\n        stroke=\"#4F46E5\"\r\n        strokeWidth={2}\r\n        strokeLinejoin=\"round\"\r\n        strokeLinecap=\"round\"\r\n        points={points}\r\n      />\r\n    </svg>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}