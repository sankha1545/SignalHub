{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///E:/SignalHub/frontend/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\r\n\r\ndeclare global {\r\n  // prevent multiple instantiation in dev\r\n  // eslint-disable-next-line no-var\r\n  var prisma: PrismaClient | undefined;\r\n}\r\n\r\nexport const prisma =\r\n  global.prisma ??\r\n  new PrismaClient({\r\n    log: [\"query\"],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\") global.prisma = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAQO,MAAM,SACX,OAAO,MAAM,IACb,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCAA2C,OAAO,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///E:/SignalHub/frontend/src/app/api/phone/verify-otp/route.ts"],"sourcesContent":["// File: src/app/api/phone/verify-otp/route.ts\r\nimport { NextResponse } from \"next/server\";\r\nimport { prisma } from \"@/lib/prisma\"; // <-- ensure this is correct path to your Prisma client\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const { phone, otp } = await req.json();\r\n\r\n    if (!phone || !otp) {\r\n      return NextResponse.json({ error: \"Phone and OTP are required\" }, { status: 400 });\r\n    }\r\n\r\n    // Find the most recent unused OTP for this phone\r\n    const record = await prisma.phoneOtp.findFirst({\r\n      where: { phone, used: false },\r\n      orderBy: { createdAt: \"desc\" },\r\n    });\r\n\r\n    if (!record) {\r\n      return NextResponse.json({ error: \"No OTP found for this phone\" }, { status: 404 });\r\n    }\r\n\r\n    // Check expiry (5 minutes)\r\n    const now = new Date();\r\n    const createdAt = new Date(record.createdAt);\r\n    const diffMins = (now.getTime() - createdAt.getTime()) / 60000;\r\n    if (diffMins > 5) {\r\n      return NextResponse.json({ error: \"OTP expired. Please request a new one.\" }, { status: 400 });\r\n    }\r\n\r\n    // Increment attempts (max 5)\r\n    if (record.attempts >= 5) {\r\n      return NextResponse.json({ error: \"Too many attempts. Request new OTP.\" }, { status: 429 });\r\n    }\r\n\r\n    // Verify OTP match\r\n    if (record.otp !== otp) {\r\n      await prisma.phoneOtp.update({\r\n        where: { id: record.id },\r\n        data: { attempts: record.attempts + 1 },\r\n      });\r\n      return NextResponse.json({ error: \"Invalid OTP\" }, { status: 400 });\r\n    }\r\n\r\n    // ✅ Mark OTP as used\r\n    await prisma.phoneOtp.update({\r\n      where: { id: record.id },\r\n      data: { used: true },\r\n    });\r\n\r\n    // ✅ Mark user as verified (assuming unique phone per user)\r\n    const updatedUser = await prisma.user.updateMany({\r\n      where: { profile: { path: [\"phoneNumber\"], equals: phone } },\r\n      data: {\r\n        profile: {\r\n          push: {\r\n            phoneVerified: true,\r\n            phoneVerifiedAt: new Date().toISOString(),\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    return NextResponse.json({\r\n      ok: true,\r\n      message: \"Phone verified successfully\",\r\n      user: updatedUser,\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error verifying OTP:\", error);\r\n    return NextResponse.json({ error: \"Internal server error\" }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,8CAA8C;;;;;AAC9C;AACA,8MAAuC,wDAAwD;;;AAExF,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG,MAAM,IAAI,IAAI;QAErC,IAAI,CAAC,SAAS,CAAC,KAAK;YAClB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA6B,GAAG;gBAAE,QAAQ;YAAI;QAClF;QAEA,iDAAiD;QACjD,MAAM,SAAS,MAAM,gIAAM,CAAC,QAAQ,CAAC,SAAS,CAAC;YAC7C,OAAO;gBAAE;gBAAO,MAAM;YAAM;YAC5B,SAAS;gBAAE,WAAW;YAAO;QAC/B;QAEA,IAAI,CAAC,QAAQ;YACX,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA8B,GAAG;gBAAE,QAAQ;YAAI;QACnF;QAEA,2BAA2B;QAC3B,MAAM,MAAM,IAAI;QAChB,MAAM,YAAY,IAAI,KAAK,OAAO,SAAS;QAC3C,MAAM,WAAW,CAAC,IAAI,OAAO,KAAK,UAAU,OAAO,EAAE,IAAI;QACzD,IAAI,WAAW,GAAG;YAChB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAyC,GAAG;gBAAE,QAAQ;YAAI;QAC9F;QAEA,6BAA6B;QAC7B,IAAI,OAAO,QAAQ,IAAI,GAAG;YACxB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsC,GAAG;gBAAE,QAAQ;YAAI;QAC3F;QAEA,mBAAmB;QACnB,IAAI,OAAO,GAAG,KAAK,KAAK;YACtB,MAAM,gIAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;gBAC3B,OAAO;oBAAE,IAAI,OAAO,EAAE;gBAAC;gBACvB,MAAM;oBAAE,UAAU,OAAO,QAAQ,GAAG;gBAAE;YACxC;YACA,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAc,GAAG;gBAAE,QAAQ;YAAI;QACnE;QAEA,qBAAqB;QACrB,MAAM,gIAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;YAC3B,OAAO;gBAAE,IAAI,OAAO,EAAE;YAAC;YACvB,MAAM;gBAAE,MAAM;YAAK;QACrB;QAEA,2DAA2D;QAC3D,MAAM,cAAc,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YAC/C,OAAO;gBAAE,SAAS;oBAAE,MAAM;wBAAC;qBAAc;oBAAE,QAAQ;gBAAM;YAAE;YAC3D,MAAM;gBACJ,SAAS;oBACP,MAAM;wBACJ,eAAe;wBACf,iBAAiB,IAAI,OAAO,WAAW;oBACzC;gBACF;YACF;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,IAAI;YACJ,SAAS;YACT,MAAM;QACR;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF","debugId":null}}]
}