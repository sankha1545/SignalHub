{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attackcapital/SignalHub/frontend/src/lib/prisma.ts"],"sourcesContent":["\r\n\r\nimport { PrismaClient, type Prisma } from \"@prisma/client\";\r\n\r\ntype GlobalWithPrisma = typeof globalThis & {\r\n  prisma?: PrismaClient;\r\n};\r\n\r\n// Use the global object available in this runtime (node, edge, etc.)\r\nconst _global = globalThis as GlobalWithPrisma;\r\n\r\n// Decide whether we want query logging enabled.\r\n// This is intentionally opt-in via DEV_LOG_QUERIES to avoid noisy logs in normal dev.\r\nconst enableQueryLogging =\r\n  process.env.DEV_LOG_QUERIES === \"true\" && process.env.NODE_ENV !== \"production\";\r\n\r\nconst prismaOptions: Prisma.PrismaClientOptions = enableQueryLogging\r\n  ? { log: [\"query\"] }\r\n  : {};\r\n\r\n// Create or reuse the PrismaClient instance\r\nconst client = _global.prisma ?? new PrismaClient(prismaOptions);\r\n\r\n// In non-production environments, attach to global to avoid new clients on HMR\r\nif (process.env.NODE_ENV !== \"production\") {\r\n  _global.prisma = client;\r\n}\r\n\r\n/**\r\n * Export named and default to be compatible with both import styles.\r\n */\r\nexport const prisma = client;\r\nexport default prisma;\r\n"],"names":[],"mappings":";;;;;;AAEA;;AAMA,qEAAqE;AACrE,MAAM,UAAU;AAEhB,gDAAgD;AAChD,sFAAsF;AACtF,MAAM,qBACJ,QAAQ,GAAG,CAAC,eAAe,KAAK,UAAU,oDAAyB;AAErE,MAAM,gBAA4C,qBAC9C;IAAE,KAAK;QAAC;KAAQ;AAAC,IACjB,CAAC;AAEL,4CAA4C;AAC5C,MAAM,SAAS,QAAQ,MAAM,IAAI,IAAI,6IAAY,CAAC;AAElD,+EAA+E;AAC/E,wCAA2C;IACzC,QAAQ,MAAM,GAAG;AACnB;AAKO,MAAM,SAAS;uCACP","debugId":null}},
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attackcapital/SignalHub/frontend/src/app/api/phone/send-otp/route.ts"],"sourcesContent":["// app/api/phone/send-otp/route.ts\r\nimport { NextResponse } from \"next/server\";\r\nimport { prisma } from \"@/lib/prisma\";\r\n\r\nconst OTP_LENGTH = 4;\r\n\r\nfunction genOtp(len = OTP_LENGTH) {\r\n  let s = \"\";\r\n  for (let i = 0; i < len; i++) s += Math.floor(Math.random() * 10).toString();\r\n  return s;\r\n}\r\n\r\nasync function sendSms(phone: string, text: string) {\r\n  const sid = process.env.TWILIO_ACCOUNT_SID;\r\n  const token = process.env.TWILIO_AUTH_TOKEN;\r\n  const from = process.env.TWILIO_FROM || process.env.TWILIO_PHONE_NUMBER;\r\n  if (sid && token && from) {\r\n    // lightweight Twilio fallback (no twilio package required)\r\n    const resp = await fetch(`https://api.twilio.com/2010-04-01/Accounts/${sid}/Messages.json`, {\r\n      method: \"POST\",\r\n      headers: {\r\n        Authorization: \"Basic \" + Buffer.from(`${sid}:${token}`).toString(\"base64\"),\r\n        \"Content-Type\": \"application/x-www-form-urlencoded\",\r\n      },\r\n      body: new URLSearchParams({\r\n        From: from,\r\n        To: phone,\r\n        Body: text,\r\n      }),\r\n    });\r\n    if (!resp.ok) {\r\n      const txt = await resp.text();\r\n      throw new Error(\"Twilio error: \" + txt);\r\n    }\r\n    return true;\r\n  } else {\r\n    // dev fallback\r\n    console.log(`[DEV SMS] To: ${phone} â€” ${text}`);\r\n    return true;\r\n  }\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const body = await req.json().catch(() => ({}));\r\n    const phone = (body?.phone ?? \"\").toString();\r\n\r\n    if (!phone) return NextResponse.json({ error: \"phone required\" }, { status: 400 });\r\n    if (!phone.startsWith(\"+\") || phone.length < 6) {\r\n      return NextResponse.json({ error: \"phone must be E.164 (e.g. +919876543210)\" }, { status: 400 });\r\n    }\r\n\r\n    const otp = genOtp();\r\n\r\n    // persist OTP record\r\n    await prisma.phoneOtp.create({\r\n      data: {\r\n        phone,\r\n        otp,\r\n        used: false,\r\n      },\r\n    });\r\n\r\n    // fire SMS (best-effort)\r\n    try {\r\n      await sendSms(phone, `Your verification code is ${otp}. It will expire in 5 minutes.`);\r\n    } catch (err) {\r\n      console.error(\"Failed to send SMS:\", err);\r\n      // keep record but tell client\r\n      return NextResponse.json({ error: \"Failed to send SMS\" }, { status: 500 });\r\n    }\r\n\r\n    // For development/testing we return debugOtp in non-production only.\r\n    const debugOtp = process.env.NODE_ENV === \"production\" ? undefined : otp;\r\n    return NextResponse.json({ ok: true, message: \"OTP sent\", debugOtp });\r\n  } catch (err) {\r\n    console.error(\"send-otp error\", err);\r\n    return NextResponse.json({ error: \"Server error\" }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,kCAAkC;;;;;AAClC;AACA;;;AAEA,MAAM,aAAa;AAEnB,SAAS,OAAO,MAAM,UAAU;IAC9B,IAAI,IAAI;IACR,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,IAAK,KAAK,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,IAAI,QAAQ;IAC1E,OAAO;AACT;AAEA,eAAe,QAAQ,KAAa,EAAE,IAAY;IAChD,MAAM,MAAM,QAAQ,GAAG,CAAC,kBAAkB;IAC1C,MAAM,QAAQ,QAAQ,GAAG,CAAC,iBAAiB;IAC3C,MAAM,OAAO,QAAQ,GAAG,CAAC,WAAW,IAAI,QAAQ,GAAG,CAAC,mBAAmB;IACvE,IAAI,OAAO,SAAS,MAAM;QACxB,2DAA2D;QAC3D,MAAM,OAAO,MAAM,MAAM,CAAC,2CAA2C,EAAE,IAAI,cAAc,CAAC,EAAE;YAC1F,QAAQ;YACR,SAAS;gBACP,eAAe,WAAW,OAAO,IAAI,CAAC,GAAG,IAAI,CAAC,EAAE,OAAO,EAAE,QAAQ,CAAC;gBAClE,gBAAgB;YAClB;YACA,MAAM,IAAI,gBAAgB;gBACxB,MAAM;gBACN,IAAI;gBACJ,MAAM;YACR;QACF;QACA,IAAI,CAAC,KAAK,EAAE,EAAE;YACZ,MAAM,MAAM,MAAM,KAAK,IAAI;YAC3B,MAAM,IAAI,MAAM,mBAAmB;QACrC;QACA,OAAO;IACT,OAAO;QACL,eAAe;QACf,QAAQ,GAAG,CAAC,CAAC,cAAc,EAAE,MAAM,GAAG,EAAE,MAAM;QAC9C,OAAO;IACT;AACF;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QAC7C,MAAM,QAAQ,CAAC,MAAM,SAAS,EAAE,EAAE,QAAQ;QAE1C,IAAI,CAAC,OAAO,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAiB,GAAG;YAAE,QAAQ;QAAI;QAChF,IAAI,CAAC,MAAM,UAAU,CAAC,QAAQ,MAAM,MAAM,GAAG,GAAG;YAC9C,OAAO,4JAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA2C,GAAG;gBAAE,QAAQ;YAAI;QAChG;QAEA,MAAM,MAAM;QAEZ,qBAAqB;QACrB,MAAM,4IAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;YAC3B,MAAM;gBACJ;gBACA;gBACA,MAAM;YACR;QACF;QAEA,yBAAyB;QACzB,IAAI;YACF,MAAM,QAAQ,OAAO,CAAC,0BAA0B,EAAE,IAAI,8BAA8B,CAAC;QACvF,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,uBAAuB;YACrC,8BAA8B;YAC9B,OAAO,4JAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAqB,GAAG;gBAAE,QAAQ;YAAI;QAC1E;QAEA,qEAAqE;QACrE,MAAM,WAAW,sCAAwC,0BAAY;QACrE,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAM,SAAS;YAAY;QAAS;IACrE,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,kBAAkB;QAChC,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;AACF","debugId":null}}]
}