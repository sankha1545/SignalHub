{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attackcapital/SignalHub/frontend/src/lib/prisma.ts"],"sourcesContent":["\r\n\r\nimport { PrismaClient, type Prisma } from \"@prisma/client\";\r\n\r\ntype GlobalWithPrisma = typeof globalThis & {\r\n  prisma?: PrismaClient;\r\n};\r\n\r\n// Use the global object available in this runtime (node, edge, etc.)\r\nconst _global = globalThis as GlobalWithPrisma;\r\n\r\n// Decide whether we want query logging enabled.\r\n// This is intentionally opt-in via DEV_LOG_QUERIES to avoid noisy logs in normal dev.\r\nconst enableQueryLogging =\r\n  process.env.DEV_LOG_QUERIES === \"true\" && process.env.NODE_ENV !== \"production\";\r\n\r\nconst prismaOptions: Prisma.PrismaClientOptions = enableQueryLogging\r\n  ? { log: [\"query\"] }\r\n  : {};\r\n\r\n// Create or reuse the PrismaClient instance\r\nconst client = _global.prisma ?? new PrismaClient(prismaOptions);\r\n\r\n// In non-production environments, attach to global to avoid new clients on HMR\r\nif (process.env.NODE_ENV !== \"production\") {\r\n  _global.prisma = client;\r\n}\r\n\r\n/**\r\n * Export named and default to be compatible with both import styles.\r\n */\r\nexport const prisma = client;\r\nexport default prisma;\r\n"],"names":[],"mappings":";;;;;;AAEA;;AAMA,qEAAqE;AACrE,MAAM,UAAU;AAEhB,gDAAgD;AAChD,sFAAsF;AACtF,MAAM,qBACJ,QAAQ,GAAG,CAAC,eAAe,KAAK,UAAU,oDAAyB;AAErE,MAAM,gBAA4C,qBAC9C;IAAE,KAAK;QAAC;KAAQ;AAAC,IACjB,CAAC;AAEL,4CAA4C;AAC5C,MAAM,SAAS,QAAQ,MAAM,IAAI,IAAI,6IAAY,CAAC;AAElD,+EAA+E;AAC/E,wCAA2C;IACzC,QAAQ,MAAM,GAAG;AACnB;AAKO,MAAM,SAAS;uCACP","debugId":null}},
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///E:/Attackcapital/SignalHub/frontend/src/app/api/contacts/%5Bid%5D/route.ts"],"sourcesContent":["// src/app/api/contacts/[id]/route.ts\r\nimport { NextResponse } from \"next/server\";\r\nimport prisma from \"@/lib/prisma\";\r\n\r\n/**\r\n * GET /api/contacts/[id] -> returns { contact, notes: Note[] }\r\n * POST /api/contacts/[id] -> create a note for the contact\r\n *\r\n * Notes:\r\n * - In App Router dynamic API routes, `params` may be a Promise; await it.\r\n * - This version is robust when `prisma.note` is missing: it falls back to a raw SQL query.\r\n */\r\n\r\nfunction devLog(...args: any[]) {\r\n  if (process.env.NODE_ENV !== \"production\") console.debug(\"[/api/contacts/[id]]\", ...args);\r\n}\r\n\r\nexport async function GET(req: Request, context: { params: Promise<{ id?: string }> }) {\r\n  try {\r\n    const awaitedParams = await context.params;\r\n    const id = awaitedParams?.id;\r\n\r\n    if (!id) {\r\n      devLog(\"missing id in params:\", awaitedParams);\r\n      return NextResponse.json({ error: \"Missing contact id in route params\" }, { status: 400 });\r\n    }\r\n\r\n    // Fetch contact (safe)\r\n    const contact = await prisma.contact.findUnique({ where: { id } });\r\n    if (!contact) return NextResponse.json({ error: \"Contact not found\" }, { status: 404 });\r\n\r\n    // Fetch notes robustly:\r\n    let notes: any[] = [];\r\n    try {\r\n      // Preferred: use prisma.note if available\r\n      if ((prisma as any).note && typeof (prisma as any).note.findMany === \"function\") {\r\n        notes = await (prisma as any).note.findMany({\r\n          where: { contactId: id },\r\n          orderBy: { createdAt: \"desc\" },\r\n        });\r\n      } else {\r\n        // Fallback: try raw SQL query against \"Note\" table (keep identifiers quoted)\r\n        devLog(\"prisma.note not found — falling back to $queryRaw for Note table\");\r\n        notes = await prisma.$queryRawUnsafe(\r\n          `SELECT * FROM \"Note\" WHERE \"contactId\" = $1 ORDER BY \"createdAt\" DESC`,\r\n          id\r\n        );\r\n      }\r\n    } catch (notesErr: any) {\r\n      devLog(\"failed to load notes via prisma.note or raw query:\", notesErr?.message ?? notesErr);\r\n      // If notes fetching fails, return empty notes with dev debug info\r\n      if (process.env.NODE_ENV !== \"production\") {\r\n        return NextResponse.json({ contact, notes: [], debug: { noteError: notesErr?.message ?? String(notesErr) } });\r\n      }\r\n      return NextResponse.json({ contact, notes: [] });\r\n    }\r\n\r\n    return NextResponse.json({ contact, notes });\r\n  } catch (err: any) {\r\n    console.error(\"GET /api/contacts/[id] error:\", err);\r\n    if (process.env.NODE_ENV !== \"production\") {\r\n      return NextResponse.json({ error: \"internal error\", detail: err?.message ?? String(err) }, { status: 500 });\r\n    }\r\n    return NextResponse.json({ error: \"internal error\" }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(req: Request, context: { params: Promise<{ id?: string }> }) {\r\n  try {\r\n    const awaitedParams = await context.params;\r\n    const id = awaitedParams?.id;\r\n\r\n    if (!id) return NextResponse.json({ error: \"Missing contact id in route params\" }, { status: 400 });\r\n\r\n    const payload = await req.json().catch(() => null);\r\n    if (!payload || typeof payload.body !== \"string\" || payload.body.trim() === \"\") {\r\n      return NextResponse.json({ error: \"Invalid request body. Expect { body: string, createdBy?: string }\" }, { status: 400 });\r\n    }\r\n\r\n    // Ensure contact exists\r\n    const contact = await prisma.contact.findUnique({ where: { id } });\r\n    if (!contact) return NextResponse.json({ error: \"Contact not found\" }, { status: 404 });\r\n\r\n    // Create note using prisma.note if available; otherwise fallback to raw INSERT\r\n    let note: any = null;\r\n    try {\r\n      if ((prisma as any).note && typeof (prisma as any).note.create === \"function\") {\r\n        note = await (prisma as any).note.create({\r\n          data: {\r\n            contactId: id,\r\n            body: payload.body.trim(),\r\n            createdBy: typeof payload.createdBy === \"string\" ? payload.createdBy : null,\r\n          },\r\n        });\r\n      } else {\r\n        devLog(\"prisma.note.create not available — falling back to raw INSERT into Note table\");\r\n        const inserted = await prisma.$executeRawUnsafe(\r\n          `INSERT INTO \"Note\" (\"id\", \"contactId\", \"body\", \"createdBy\", \"createdAt\")\r\n           VALUES (gen_random_uuid()::text, $1, $2, $3, NOW())`,\r\n          id,\r\n          payload.body.trim(),\r\n          typeof payload.createdBy === \"string\" ? payload.createdBy : null\r\n        );\r\n        // $executeRawUnsafe returns number of affected rows; fetch last note row as best-effort\r\n        const fetched = await prisma.$queryRawUnsafe(`SELECT * FROM \"Note\" WHERE \"contactId\" = $1 ORDER BY \"createdAt\" DESC LIMIT 1`, id);\r\n        note = Array.isArray(fetched) && fetched.length ? fetched[0] : null;\r\n      }\r\n    } catch (createErr: any) {\r\n      console.error(\"failed to create note:\", createErr);\r\n      if (process.env.NODE_ENV !== \"production\") {\r\n        return NextResponse.json({ ok: false, error: \"Failed to create note\", detail: createErr?.message ?? String(createErr) }, { status: 500 });\r\n      }\r\n      return NextResponse.json({ ok: false, error: \"Failed to create note\" }, { status: 500 });\r\n    }\r\n\r\n    return NextResponse.json({ ok: true, note });\r\n  } catch (err: any) {\r\n    console.error(\"POST /api/contacts/[id] error:\", err);\r\n    if (process.env.NODE_ENV !== \"production\") {\r\n      return NextResponse.json({ error: \"internal error\", detail: err?.message ?? String(err) }, { status: 500 });\r\n    }\r\n    return NextResponse.json({ error: \"internal error\" }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}